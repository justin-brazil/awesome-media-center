<img src="https://upload.wikimedia.org/wikipedia/commons/7/79/Docker_%28container_engine%29_logo.png" alt="alt text">
Media center using docker-compose with Traefik, Portainer, Nextcloud and Emby.

## Overview

Traefik acts as a reverse proxy to expose the running docker containers, exposes ports 80 and 443. Port 80 gets redirected to 443 to enforce HTTPS. Services are registered as dynamic DNS entries in the host machine, that maps a subdomain for the respective container. Each of the service has a config, using docker labels, to map on what port is the container running, so that Traefik can handle the routing to our containers. Addittionally, each service is SSL certified, managed by Traefik using Letsencrypt. 

## Prerequisites

* Domain, with the subdomains registered
* Server
* Docker and docker-compose

## Installation

Each of the services is representd by a docker stack, containing a *docker-compose.yml*. For the installation to be more manageable, the only two service deployed by docker cli are [traefik](#traefik) and [portainer](#portainer). The remianing services will be deployed using portainer to easily manage the stack.

To run a service:
```sh
$ docker-compose up -d
```

Any issue with the installation should refer to the [problems](#problems) section.

### <a name="traefik"></a> Traefik

On the *traefik.toml* one should change the property *entryPoints.traefik.auth.basic*. The password should be generated by *htpasswd*, and for each character "$" should be escaped by inserting another "$" character.

### <a name="portainer"></a> Portainer

There's no configuration needed here. For the present moment Templates are not working.

### Nextcloud

Should be deployed using portainer under stacks.

To setup wizard requires the following credentials:
* *user* - nextcloud
* *password* - secret
* *database* - nextcloud
* *host* - db:3306

### Emby

Should be deployed using portainer under stacks.

The volumes should be changed to match the wanted mount. The *UID* and *GID* on the environment are described in the section [User ID and Group ID](#user).    

### Transmission

Should be deployed using portainer under stacks.

The volumes should be changed to match the wanted mount. The *PUID* and *PGID* on the environment are described in the section [User ID and Group ID](#user). 

### <a name="user"></a> User ID and Group ID

With the user you're running docker run:
```sh
$ id -u 
```
returns UID for the user, and 
```sh
$ id -g
```
returns GID for the user.

## <a name="problems"></a> Problems

Permissions on *acme.json* are too open then run: 
```sh
$ chmod 600 acme.json
```
 
  Written by [@snackk](https://github.com/snackk)
